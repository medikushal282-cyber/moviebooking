<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login — BookYourShow</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
        }
    </style>
</head>

<body
    class="min-h-screen w-full bg-gradient-to-br from-purple-600 via-pink-500 to-orange-400 flex items-center justify-center p-4">

    <!-- Background decorative elements -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-20 left-20 w-72 h-72 bg-white/20 rounded-full blur-3xl"></div>
        <div class="absolute bottom-20 right-20 w-96 h-96 bg-purple-300/30 rounded-full blur-3xl"></div>
        <div
            class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-pink-300/20 rounded-full blur-3xl">
        </div>
    </div>

    <a href="index.html"
        class="absolute top-5 left-5 text-white/80 hover:text-white flex items-center gap-2 z-20 transition-colors">
        <i data-feather="arrow-left" class="w-4 h-4"></i> Back to Home
    </a>

    <!-- Auth Card -->
    <div class="relative z-10 w-full max-w-md">
        <!-- Glassmorphic Card -->
        <div class="bg-white/10 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 p-8">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 id="formTitle" class="text-white text-2xl font-bold mb-2">Welcome Back</h1>
                <p id="formSubtitle" class="text-white/80 text-sm">Sign in to continue</p>
            </div>

            <!-- Auth Method Tabs -->
            <div class="flex gap-2 mb-6 bg-white/5 p-1 rounded-xl">
                <button id="tabEmail" onclick="setAuthMethod('email')"
                    class="flex-1 flex items-center justify-center gap-2 py-3 rounded-lg transition-all bg-white/20 text-white shadow-lg">
                    <i data-feather="mail" class="w-4 h-4"></i>
                    <span class="text-sm font-medium">Email</span>
                </button>
                <button id="tabMobile" onclick="setAuthMethod('mobile')"
                    class="flex-1 flex items-center justify-center gap-2 py-3 rounded-lg transition-all text-white/60 hover:text-white/80">
                    <i data-feather="smartphone" class="w-4 h-4"></i>
                    <span class="text-sm font-medium">Mobile</span>
                </button>
            </div>

            <!-- Form -->
            <form id="authForm" class="space-y-4 mb-6" onsubmit="return false;">

                <!-- Name Field (Signup Only) -->
                <div id="nameField" class="hidden">
                    <label for="name" class="block text-white/90 text-sm mb-2">Full Name</label>
                    <input id="name" type="text" placeholder="John Doe"
                        class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/40 focus:border-transparent backdrop-blur-sm transition-all">
                </div>

                <!-- Identifier Field (Email or Mobile) -->
                <div>
                    <label id="identifierLabel" for="identifier" class="block text-white/90 text-sm mb-2">Email
                        Address</label>
                    <input id="identifier" type="email" placeholder="you@example.com"
                        class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/40 focus:border-transparent backdrop-blur-sm transition-all">
                </div>

                <!-- Password Field -->
                <div>
                    <label for="password" class="block text-white/90 text-sm mb-2">Password</label>
                    <input id="password" type="password" placeholder="••••••••"
                        class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/40 focus:border-transparent backdrop-blur-sm transition-all">
                </div>

                <!-- Confirm Password Field (Signup Only) -->
                <div id="confirmPasswordField" class="hidden">
                    <label for="confirmPassword" class="block text-white/90 text-sm mb-2">Confirm Password</label>
                    <input id="confirmPassword" type="password" placeholder="••••••••"
                        class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/40 focus:border-transparent backdrop-blur-sm transition-all">
                </div>

                <!-- Remember Me / Forgot Password (Login Only) -->
                <div id="loginOptions" class="flex items-center justify-between text-sm">
                    <label class="flex items-center text-white/80 cursor-pointer hover:text-white transition-colors">
                        <input type="checkbox"
                            class="mr-2 w-4 h-4 rounded bg-white/10 border-white/20 accent-purple-500">
                        Remember me
                    </label>
                    <a href="#" class="text-white/90 hover:text-white transition-colors">Forgot password?</a>
                </div>

                <!-- Submit Button -->
                <button id="submitBtn" onclick="handleSubmit()"
                    class="w-full py-3 bg-white text-purple-600 font-bold rounded-xl hover:bg-white/90 transition-all shadow-lg transform hover:-translate-y-0.5">
                    Sign In
                </button>
            </form>

            <!-- Divider -->
            <div class="relative mb-6">
                <div class="absolute inset-0 flex items-center">
                    <div class="w-full border-t border-white/20"></div>
                </div>
                <div class="relative flex justify-center text-sm">
                    <span class="px-4 bg-transparent text-white/60">Or continue with</span>
                </div>
            </div>

            <!-- Google Sign In -->
            <button onclick="alert('Google Sign In coming soon!')"
                class="w-full py-3 bg-white/10 border border-white/20 rounded-xl text-white hover:bg-white/20 transition-all flex items-center justify-center gap-3 backdrop-blur-sm group">
                <svg class="w-5 h-5 transition-transform group-hover:scale-110" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M12.48 10.92v3.28h7.84c-.24 1.84-.853 3.187-1.787 4.133-1.147 1.147-2.933 2.4-6.053 2.4-4.827 0-8.6-3.893-8.6-8.72s3.773-8.72 8.6-8.72c2.6 0 4.507 1.027 5.907 2.347l2.307-2.307C18.747 1.44 16.133 0 12.48 0 5.867 0 .533 5.333.533 12S5.867 24 12.48 24c3.44 0 6.333-1.133 8.453-3.293 2.16-2.16 3.533-5.213 3.533-8.787 0-.573-.053-1.107-.16-1.627h-11.827z" />
                </svg>
                <span>Continue with Google</span>
            </button>

            <!-- Toggle Sign Up/Login -->
            <div class="mt-6 text-center text-sm text-white/80">
                <span id="toggleText">Don't have an account? </span>
                <button onclick="toggleMode()" id="toggleBtn" class="text-white hover:underline font-medium ml-1">
                    Sign Up
                </button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Feather Icons
        feather.replace();

        // State
        let isSignUp = false;
        let authMethod = 'email'; // 'email' | 'mobile'

        // Elements
        const formTitle = document.getElementById('formTitle');
        const formSubtitle = document.getElementById('formSubtitle');
        const submitBtn = document.getElementById('submitBtn');
        const toggleText = document.getElementById('toggleText');
        const toggleBtn = document.getElementById('toggleBtn');

        const nameField = document.getElementById('nameField');
        const confirmPasswordField = document.getElementById('confirmPasswordField');
        const loginOptions = document.getElementById('loginOptions');

        const tabEmail = document.getElementById('tabEmail');
        const tabMobile = document.getElementById('tabMobile');
        const identifierLabel = document.getElementById('identifierLabel');
        const identifierInput = document.getElementById('identifier');

        // Functions
        function setAuthMethod(method) {
            authMethod = method;

            // Update Tabs
            if (method === 'email') {
                tabEmail.className = "flex-1 flex items-center justify-center gap-2 py-3 rounded-lg transition-all bg-white/20 text-white shadow-lg";
                tabMobile.className = "flex-1 flex items-center justify-center gap-2 py-3 rounded-lg transition-all text-white/60 hover:text-white/80";

                identifierLabel.textContent = "Email Address";
                identifierInput.type = "email";
                identifierInput.placeholder = "you@example.com";
            } else {
                tabMobile.className = "flex-1 flex items-center justify-center gap-2 py-3 rounded-lg transition-all bg-white/20 text-white shadow-lg";
                tabEmail.className = "flex-1 flex items-center justify-center gap-2 py-3 rounded-lg transition-all text-white/60 hover:text-white/80";

                identifierLabel.textContent = "Mobile Number";
                identifierInput.type = "tel";
                identifierInput.placeholder = "+1 (555) 123-4567";
            }
        }

        function toggleMode() {
            isSignUp = !isSignUp;

            if (isSignUp) {
                // Switch to Sign Up
                formTitle.textContent = "Create Account";
                formSubtitle.textContent = "Sign up to get started";
                submitBtn.textContent = "Sign Up";
                toggleText.textContent = "Already have an account? ";
                toggleBtn.textContent = "Sign In";

                nameField.classList.remove('hidden');
                confirmPasswordField.classList.remove('hidden');
                loginOptions.classList.add('hidden');
            } else {
                // Switch to Login
                formTitle.textContent = "Welcome Back";
                formSubtitle.textContent = "Sign in to continue";
                submitBtn.textContent = "Sign In";
                toggleText.textContent = "Don't have an account? ";
                toggleBtn.textContent = "Sign Up";

                nameField.classList.add('hidden');
                confirmPasswordField.classList.add('hidden');
                loginOptions.classList.remove('hidden');
            }
        }

        async function handleSubmit() {
            const btn = document.getElementById('submitBtn');
            const originalText = btn.textContent;
            btn.textContent = 'Processing...';
            btn.disabled = true;
            btn.classList.add('opacity-70', 'cursor-not-allowed');

            try {
                let url, body;
                const password = document.getElementById('password').value;
                const identifier = document.getElementById('identifier').value;

                if (isSignUp) {
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    const name = document.getElementById('name').value;

                    if (!password || !confirmPassword || !identifier || !name) throw new Error('Please fill all fields');
                    if (password !== confirmPassword) throw new Error('Passwords do not match');

                    body = { password, name };

                    if (authMethod === 'email') {
                        body.email = identifier;
                    } else {
                        body.phone = identifier;
                    }

                    url = 'http://localhost:5000/api/v1/auth/register';
                } else {
                    if (!identifier || !password) throw new Error('Please fill all fields');

                    url = 'http://localhost:5000/api/v1/auth/login';
                    body = { email: identifier, password };
                }

                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.error || 'Authentication failed');
                }

                if (isSignUp) {
                    btn.textContent = 'Check your email!';
                    btn.classList.remove('bg-white', 'text-purple-600');
                    btn.classList.add('bg-green-500', 'text-white');

                    const emailOrPhone = data.email || data.phone;
                    setTimeout(() => {
                        window.location.href = `verify-email.html?email=${encodeURIComponent(emailOrPhone)}`;
                    }, 1500);
                } else {
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));

                    btn.textContent = 'Success!';
                    btn.classList.remove('bg-white', 'text-purple-600');
                    btn.classList.add('bg-green-500', 'text-white');

                    setTimeout(() => {
                        const urlParams = new URLSearchParams(window.location.search);
                        const redirectUrl = urlParams.get('redirect');

                        if (redirectUrl) {
                            window.location.href = decodeURIComponent(redirectUrl);
                        } else if (data.user.role === 'admin') {
                            window.location.href = 'admin.html';
                        } else {
                            window.location.href = 'index.html';
                        }
                    }, 1000);
                }

            } catch (error) {
                console.error('Auth Error:', error);
                alert(error.message);
                btn.textContent = originalText;
                btn.disabled = false;
                btn.classList.remove('opacity-70', 'cursor-not-allowed', 'bg-green-500', 'text-white');
                btn.classList.add('bg-white', 'text-purple-600');
            }
        }
    </script>
</body>

</html>